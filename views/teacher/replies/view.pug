extends ../../includes/layout

block content

    .row
        .col-md-12.col-lg-4#topics-column
            include ../menu
        .hidden-md-down.col-lg-8#tasks-column
            //-include tasks
            div.d-flex.justify-content-center
                .col-12
                    h2.text-center=data.topic.number + '. ' + data.topic.title
                    h3.text-center=data.number + '. ' + data.title

                    div.text-center
                        form(onsubmit='return false;')
                            label(for='selectLab') Wybierz grupy do sprawdzenia
                            br
                            select#selectLab(name='labs', multiple)
                                each lab in data.labs
                                    option(value=lab.id)= lab.name + ' - ' + lab.owner.fullName()
                            br
                            input(type='submit' onclick='getLabTasks();')

                    div#labs


                    script.
                        function getLabTasks(){
                          var selected = $('#selectLab').val();
                          $('#labs').html('<h3 id="labSpinner">Ładowanie <i class=\'fa fa-spinner fa-spin\'></i></h3>');
                          var gets = [];
                          for(var s in selected) {
                              gets.push($.get("/ajax/teacher/replies/view/" + #{data.id} + "/lab/" + selected[s], function (data) {
                                  $('#labs').prepend(data);
                              }));
                          }
                          $.when.apply($, gets).then(function(){
                              $('#labSpinner').remove()
                          })
                            return false;
                        }

                        function saveDeadline(student, task, del){
                          var deadline = $('#deadline-student-'+student+'-task-'+task)
                          $.ajax({
                            url: '/ajax/teacher/replies/setStudentDeadline/' + task,
                            method: 'POST',
                            data: {
                              student: student,
                              deadline: deadline.val(),
                              remove: del
                            }
                          }).done(function () {
                            if(del){
                              alert('Skasowano własny termin')
                            }
                            else {
                              alert('Ustawiono własny termin')
                            }
                          })
                            .fail(function (jqXHR, textStatus, errorThrown) {
                              alert('Nie udało się zmienić terminu:  ' + textStatus + ' - ' + errorThrown)
                            })
                        }

                        function setTeacherStatus(id, e){
                          $.ajax({
                            url: '/ajax/teacher/replies/setTeacherStatus/' + id,
                            method: 'POST',
                            data: {
                              status: e.value
                            }
                          }).done(function () {
                            var task = $('#reply-' + id);
                            if (e.value === '0') {
                              task.css('background-color', '')
                            }
                            else if (e.value === '1') {
                              task.css('background-color', 'lightgreen')
                            } else if (e.value === '2') {
                              task.css('background-color', 'rgba(200,0,0,0.7)')
                            }
                          })
                            .fail(function (jqXHR, textStatus, errorThrown) {
                              alert('Nie udało się zmienić oceny:  ' + textStatus + ' - ' + errorThrown)
                            })
                        }